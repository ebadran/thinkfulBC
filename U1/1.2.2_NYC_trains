-- The ID's and durations for all trips of duration greater than 500, ordered by duration:
SELECT
    trip_id,
    duration
FROM trips
WHERE trip_id > 500
ORDER BY duration;


-- Every column of the stations table for station id 84:
SELECT *
FROM stations
WHERE station_id = 84;


-- The min temperatures of all the occurrences of rain in zip 94301:
SELECT 
     minTemperatureF
FROM weather
WHERE
     PrecipitationIn != 0 and
     ZIP = 94301;


-- What was the hottest day in our data set? Where was that?
SELECT
     MAX(MaxTemperatureF) max_temp,
     Date,
     ZIP
FROM weather;


-- How many trips started at each station?
SELECT
	start_station,
	COUNT(trip_id) num_trips
FROM trips
GROUP BY start_station;


-- What's the shortest trip that happened?
SELECT
	trip_id,
	MIN(duration) duration
FROM trips;


-- What is the average trip duration, by end station?
SELECT
	end_station,
	AVG(duration) average
FROM trips
GROUP BY end_station;


-- What are the three longest trips on rainy days?
SELECT 
	t.trip_id,
	t.duration,
	DATE(t.start_date) trip_date
FROM trips t
JOIN weather w
ON trip_date = w.Date
WHERE w.PrecipitationIn != 0 -- some days had rain and other events
GROUP BY t.trip_id
ORDER BY duration DESC
LIMIT 3;

-- Which station is full most often?
SELECT
	station_id,
	COUNT (
	CASE WHEN docks_available=0 
	THEN 1 END
	) station_full
FROM status
GROUP BY station_id
ORDER BY station_full DESC
LIMIT 1;

-- Return a list of stations with a count of number of trips starting at that station but ordered by dock count:
SELECT
	start_station,
	dockcount,
	COUNT(start_station)
FROM trips
JOIN stations
ON stations.name = trips.start_station
GROUP BY start_station, dockcount
ORDER BY dockcount DESC;


-- What's the length of the longest trip for each day it rains anywhere?
WITH
rainy AS (
	SELECT 
	DATE(Date) rainy_days
	From weather
	WHERE PrecipitationIn != 0
	GROUP BY 1
	),
rainy_trips AS (
	SELECT
	trip_id,
	duration,
	DATE(start_date) trip_date
	FROM trips
	JOIN rainy
	ON rainy_days = trip_date
	ORDER BY duration DESC
	)
SELECT 
trip_date,
max(duration)
FROM rainy_trips
GROUP BY 1
